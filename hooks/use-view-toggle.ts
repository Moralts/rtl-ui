import { useState, useEffect, useCallback } from 'react';
import type { ViewType } from '@/types';
import { STORAGE_KEYS } from '@/constants';

/**
 * 管理主页和实例设置视图切换的 Hook
 */
export function useViewToggle() {
  const [currentView, setCurrentView] = useState<ViewType>('home');
  
  useEffect(() => {
    const savedView = localStorage.getItem(STORAGE_KEYS.CURRENT_VIEW) as ViewType;
    if (savedView) {
      setCurrentView(savedView);
    }
  }, []);

  const toggleView = useCallback(() => {
    const newView: ViewType = currentView === 'home' ? 'new' : 'home';
    setCurrentView(newView);
    if (typeof window !== 'undefined') {
      localStorage.setItem(STORAGE_KEYS.CURRENT_VIEW, newView);
    }
  }, [currentView]);

  const setView = useCallback((view: ViewType) => {
    setCurrentView(view);
    if (typeof window !== 'undefined') {
      localStorage.setItem(STORAGE_KEYS.CURRENT_VIEW, view);
    }
  }, []);

  return {
    currentView,
    toggleView,
    setView,
  };
}
